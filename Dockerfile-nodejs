FROM node:8-stretch as builder
RUN apt-get update
RUN apt-get install -y bison cmake flex libboost-dev libboost-filesystem-dev libboost-regex-dev libboost-system-dev
RUN groupadd -r nodejs && useradd -m -r -g nodejs -s /bin/bash nodejs
USER nodejs
WORKDIR /home/nodejs
COPY package*.json ./
RUN npm install

FROM node:8-slim
RUN groupadd -r nodejs && useradd -m -r -g nodejs -s /bin/bash nodejs
USER nodejs
WORKDIR /home/nodejs
COPY --from=builder /home/nodejs .
COPY . .

